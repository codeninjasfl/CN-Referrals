<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#2563eb" />
  <title>Code Ninjas - Share Your Story For $100 Off</title>
  <meta name="description" content="Generate a social-ready post about your childâ€™s Code Ninjas experience â€” and share a QR that links to your dojoâ€™s signup page. Every referral equals $100 off your next month (stackable up to your dojoâ€™s limit)." />
  <style>
    :root{
    :root {
      --bg1:#0ea5e9;
      --bg2:#2563eb;
      --card:#ffffff;
@@ -16,18 +16,25 @@
      --brand:#2563eb;
      --accent:#22d3ee;
      --border:#e5e7eb;
      --radius:18px;
      --shadow:0 14px 34px rgba(2,6,23,.18), 0 2px 10px rgba(2,6,23,.08);
      --radius:16px;
      --radius-xl:22px;
      --shadow:0 12px 30px rgba(2,6,23,.18), 0 2px 8px rgba(2,6,23,.08);
      --shadow-soft:0 14px 40px rgba(15,23,42,.20), 0 3px 10px rgba(15,23,42,.10);
      --font-sans:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif;
      --transition-fast:0.18s ease-out;
    }

    *{box-sizing:border-box}

    html,body{
    html, body {
      margin:0;
      height:100%;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans;
      min-height:100%;
      font-family:var(--font-sans);
      color:var(--ink);
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      background-repeat:no-repeat;
      background-attachment:fixed;
      background-size:cover;
    }

    /* Top-right nav shared with Home */
@@ -58,35 +65,39 @@
    .top-nav span{
      opacity:.4;
    }
    @media(max-width:768px){
      .top-nav{
        position:static;
        justify-content:center;
        margin:6px auto 0;
        font-size:11px;
        font-weight:600;
      }
    @media (max-width:768px) {$1
    }

    .wrap{
      min-height:100%;
      display:grid;
      place-items:start center;
      padding:54px 20px 20px;
    .page-wrap {
      min-height:100svh;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:22px 16px 32px;
      gap:14px;
    }

    .layout {
      width:min(640px,100%);
      margin:0 auto;
      display:flex;
      flex-direction:column;
      gap:14px;
      align-items:stretch;
    }
    header{color:#eef6ff;text-align:center;margin-bottom:12px}
    header{color:#eef6ff;text-align:center;margin:18px auto 8px;width:min(640px,100%);}
    header .brand{display:flex;align-items:center;justify-content:center;gap:10px}
    header img.logo{height:42px;width:auto;filter:drop-shadow(0 1px 0 rgba(0,0,0,.15))}
    header h1{margin:6px 0 0;font-size:clamp(22px,4vw,34px)}
    header p{margin:6px 0 0;color:#dbeafe}

    .card{
      width:min(920px,96vw);
    .card {
      width:100%;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:var(--radius);
      border-radius:var(--radius-xl);
      box-shadow:var(--shadow);
      padding:22px;
      padding:18px 18px 20px;
    }
    .hint{color:var(--muted);font-size:12px;margin:0 0 10px}
    label{font-weight:700;display:block;margin:0 0 6px}
@@ -213,7 +224,7 @@
    <a href="./generate.html" class="active">Generate</a>
  </nav>

  <div class="wrap">
  <div class="page-wrap">
    <header>
      <div class="brand">
        <img class="logo" src="https://www.codeninjas.com/hubfs/Group%201.svg" alt="Code Ninjas logo" onerror="this.style.display='none'">
@@ -222,7 +233,8 @@
      <p class="sub">Generate a quick post about your childâ€™s Code Ninjas experience. Every friend who enrolls with your referral is <strong>$100 off</strong> your next month.</p>
    </header>

    <section class="card fade" aria-label="Referral social generator">
    <main class="layout">
      <section class="card fade" aria-label="Referral social generator">
      <div class="wizard-head">
        <div id="stepLabel" class="mini">Step 1 of 7</div>
        <div class="progress"><div id="progressBar" class="bar"></div></div>
@@ -329,447 +341,448 @@
        <button id="next" class="btn primary" type="button">Next â–¶</button>
      </div>
    </section>
    </main>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>
  <div id="qrHidden" class="hidden" aria-hidden="true"></div>

  <script>
  (function(){
    'use strict';

    function byId(id){ return document.getElementById(id); }

    var els = {
      stepLabel: byId('stepLabel'),
      progressBar: byId('progressBar'),
      steps: Array.prototype.slice.call(document.querySelectorAll('.step')),
      back: byId('back'),
      next: byId('next'),
      likesChips: byId('likesChips'),
      captionOutput: byId('captionOutput'),
      copyCaption: byId('copyCaption'),
      regenCaption: byId('regenCaption'),
      toast: byId('toast'),
      qrCanvas: byId('qrCanvas'),
      downloadQR: byId('downloadQR'),
      qrStatus: byId('qrStatus'),
      qrHidden: byId('qrHidden')
    };

    var state = {
      step: 0,
      total: els.steps.length,
      dojo: '',
      childName: '',
      gender: '',
      program: '',
      likes: [],
      vibe: 'warm',
      captionSeed: 0
    };

    var booking = {
      'Aventura': 'https://www.codeninjas.com/fl-aventura',
      'Cooper City': 'https://www.codeninjas.com/fl-cooper-city',
      'Weston': 'https://www.codeninjas.com/fl-weston'
    };

    var likeOptions = [
      'Flexible schedule',
      'Safe, positive environment',
      'Mentors who really care',
      'Seeing real coding skills',
      'Games + learning combo',
      'Structured belt system',
      'STEM skills for the future',
      'My child asks to go back',
      'Screen time with a purpose',
      'Confidence & independence'
    ];

    var vibes = {
      warm: {
        openers: [
          "Proud parent alert: {name} {be} thriving in {program} at Code Ninjas {dojo}. ",
          "Honestly, watching {name} grow at Code Ninjas {dojo} has been one of the best decisions we\'ve made. ",
          "{name} {be} all smiles leaving Code Ninjas {dojo} lately and I totally get why. "
        ],
        middles: [
          "{subjCap} {be} {verb} and getting hands-on with {specific}. ",
          "It\'s become {possCap} spot to {verb} and dive into {specific}. ",
          "The way {subj} light{be} up talking about {specific} is everything. "
        ],
        parentLines: [
          "As a parent, I love that it\'s {likes}. ",
          "From my side, it\'s the {likes} for me. ",
          "Parent win: {likes}. "
        ],
        callouts: [
          "If you\'ve got a kid who loves games or tech, seriously check it out.",
          "If your kid loves Minecraft, Roblox or tech, this place is worth a look.",
          "If you\'ve been looking for something fun + educational, highly recommend giving it a try."
        ]
      },
      hype: {
        openers: [
          "{name} is OBSESSED with Code Ninjas {dojo} ðŸ”¥ ",
          "Big shoutout to Code Ninjas {dojo} for leveling {name} up ðŸ™Œ ",
          "Code Ninjas {dojo} has my kid in full-on creator mode ðŸ’»âš¡ "
        ],
        middles: [
          "{subjCap} {be} busy {verb} and jumping into {specific}. ",
          "{subjCap} {be} all about {specific} lately and I\'m here for it. ",
          "Every session = more {specific} and more confidence. "
        ],
        parentLines: [
          "I love that it\'s {likes}. ",
          "Huge fan of how it gives us {likes}. ",
          "Parent-approved: {likes}. "
        ],
        callouts: [
          "If your kid loves games, get them in here.",
          "Got a gamer kid? You HAVE to check this out.",
          "Drop me a message if you want our experience or details."
        ]
      },
      simple: {
        openers: [
          "{name} loves going to Code Ninjas {dojo}. ",
          "We\'ve had such a good experience at Code Ninjas {dojo}. ",
          "Code Ninjas {dojo} has been awesome for {name}. "
        ],
        middles: [
          "{subjCap} {be} {verb} and enjoying {specific}. ",
          "It\'s a fun place for {obj} to {verb}. ",
          "It\'s become a weekly highlight with {specific}. "
        ],
        parentLines: [
          "I really like that it\'s {likes}. ",
          "For us, it\'s the {likes}. ",
          "We appreciate the {likes}. "
        ],
        callouts: [
          "If you\'re curious, check them out.",
          "Happy to share more if anyone\'s interested.",
          "Worth a look if your kid likes tech or games."
        ]
      }
    };

    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)] || ''; }

    function oxford(list){
      if(!list.length) return '';
      if(list.length === 1) return list[0];
      if(list.length === 2) return list[0] + ' & ' + list[1];
      return list.slice(0,-1).join(', ') + ' & ' + list[list.length - 1];
    }

    function buildContext(){
      var o = state;
      var name = o.childName || 'My kid';
      var subj = name;
      var obj = name;
      var poss = name + "'s";
      var be = 'is';

      if(o.gender === 'boy'){
        be = 'is';
        subj = 'He';
        obj = 'him';
        poss = 'his';
      } else if(o.gender === 'girl'){
        be = 'is';
        subj = 'She';
        obj = 'her';
        poss = 'her';
      }
      // For 'other' or not set, stay neutral: "{name} is ..."

      return {
        name: name,
        subj: subj,
        obj: obj,
        poss: poss,
        be: be,
        subjCap: subj,
        possCap: poss,
        verb: '',
        specific: '',
        dojo: state.dojo || '',
        program: state.program || ''
      };
    }

    var programSnippets = {
      JR: {
        verbs: ['building confidence','learning sequencing','tackling logic puzzles','exploring early STEM'],
        specifics: ['visual lessons','hands-on projects','play-based learning']
      },
      CREATE: {
        verbs: ['coding games','leveling up through belts','debugging like a champ','thinking like a developer'],
        specifics: ['MakeCode to JavaScript','game design and testing','mentor-guided projects']
      },
      'Robotics Academy': {
        verbs: ['building and programming robots','mixing hardware with code','solving real-world challenges'],
        specifics: ['sensors and motors','engineering design','team problem-solving']
      },
      'AI Academy': {
        verbs: ['experimenting with AI','learning how models work','using technology responsibly'],
        specifics: ['ethical AI basics','hands-on projects','logic and data thinking']
      },
      'Clubs': {
        verbs: ['creating with friends','showing off new ideas','trying something new each week'],
        specifics: ['weekly themes','collab builds','mentor-led showcases']
      }
    };

    function buildCaption(){
      var o = state;
      var ctx = buildContext();
      var cfg = vibes[o.vibe] || vibes.warm;
      var progCfg = programSnippets[o.program] || programSnippets.CREATE;

      ctx.verb = pick(progCfg.verbs);
      ctx.specific = pick(progCfg.specifics);

      var opener = pick(cfg.openers)
        .replace(/\{name\}/g, ctx.name)
        .replace(/\{dojo\}/g, o.dojo)
        .replace(/\{program\}/g, o.program || 'Code Ninjas')
        .replace(/\{be\}/g, ctx.be);

      var middle = pick(cfg.middles)
        .replace(/\{subjCap\}/g, ctx.subjCap)
        .replace(/\{be\}/g, ctx.be)
        .replace(/\{verb\}/g, ctx.verb)
        .replace(/\{specific\}/g, ctx.specific)
        .replace(/\{obj\}/g, ctx.obj)
        .replace(/\{possCap\}/g, ctx.possCap)
        .replace(/\{subj\}/g, ctx.subj);

      var likes = o.likes.length ? oxford(o.likes) : '';
      var likeLine = likes ? pick(cfg.parentLines).replace('{likes}', likes) : '';
      var call = pick(cfg.callouts);
      var link = booking[o.dojo] || 'https://www.codeninjas.com/';

      return (opener + middle + likeLine + '\n\n' + call + '\n' + link).trim();
    }

    function showToast(msg){
      els.toast.textContent = msg;
      els.toast.classList.add('show');
      setTimeout(function(){ els.toast.classList.remove('show'); }, 2200);
    }

    function setStep(i){
      var total = state.total;
      i = Math.max(0, Math.min(i, total - 1));
      state.step = i;
      els.steps.forEach(function(s, idx){ s.classList.toggle('active', idx === i); });
      els.stepLabel.textContent = 'Step ' + (i + 1) + ' of ' + total;
      var pct = (i / (total - 1)) * 100;
      els.progressBar.style.insetInlineEnd = (100 - pct) + '%';
      els.back.disabled = (i === 0);
      els.next.textContent = (i === total - 1) ? 'Finish' : 'Next â–¶';
    }

    function ensureLikesChips(){
      if(els.likesChips.childElementCount) return;
      likeOptions.forEach(function(label){
        var btn = document.createElement('button');
        btn.type = 'button';
        btn.className = 'chip';
        btn.textContent = label;
        btn.addEventListener('click', function(){
          var idx = state.likes.indexOf(label);
          var pressed = idx === -1;
          if(pressed){ state.likes.push(label); }
          else { state.likes.splice(idx,1); }
          btn.setAttribute('aria-pressed', pressed ? 'true' : 'false');
        });
        els.likesChips.appendChild(btn);
      });
    }

    function ensureVibeButtons(){
      var buttons = Array.prototype.slice.call(document.querySelectorAll('.chip-vibe'));
      if(!buttons.length) return;
      function setActive(v){
        state.vibe = v;
        buttons.forEach(function(b){
          b.setAttribute('aria-pressed', b.getAttribute('data-vibe') === v ? 'true' : 'false');
        });
      }
      buttons.forEach(function(btn){
        btn.addEventListener('click', function(){ setActive(btn.getAttribute('data-vibe')); });
      });
      setActive('warm');
    }

    function generateQR(){
      var dojo = state.dojo;
      var url = booking[dojo] || 'https://www.codeninjas.com/';
      if(!dojo){
        els.qrStatus.textContent = 'Select your dojo to generate a QR code.';
        return;
      }

      var qrDiv = els.qrHidden;
      qrDiv.innerHTML = '';
      var qr = new QRCode(qrDiv, {
        text: url,
        width: 512,
        height: 512,
        correctLevel: QRCode.CorrectLevel.H
      });

      setTimeout(function(){
        try {
          var img = qrDiv.querySelector('img') || qrDiv.querySelector('canvas');
          if(!img) throw new Error('QR element missing');

          var canvas = els.qrCanvas;
          var ctx = canvas.getContext('2d');
          ctx.clearRect(0,0,canvas.width,canvas.height);
          ctx.fillStyle = '#ffffff';
          ctx.fillRect(0,0,canvas.width,canvas.height);

          var size = Math.min(canvas.width, canvas.height) * 0.86;
          var x = (canvas.width - size)/2;
          var y = (canvas.height - size)/2;

          if(img.tagName === 'IMG'){
            var tmp = document.createElement('canvas');
            tmp.width = img.naturalWidth;
            tmp.height = img.naturalHeight;
            var tctx = tmp.getContext('2d');
            tctx.drawImage(img,0,0);
            ctx.drawImage(tmp, x, y, size, size);
          } else {
            ctx.drawImage(img, x, y, size, size);
          }

          els.downloadQR.disabled = false;
          els.qrStatus.textContent = 'QR ready! Download and add it to your post or printed handout.';
        } catch(err){
          console.error(err);
          els.qrStatus.textContent = 'Could not render QR image, but the link above still works.';
        }
      }, 260);
    }

    function handleDownloadQR(){
      var canvas = els.qrCanvas;
      try {
        var link = document.createElement('a');
        link.download = 'codeninjas-referral-qr.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        showToast('QR code downloaded');
      } catch(err){
        console.error(err);
        showToast('Unable to download QR (browser blocked).');
      }
    }

    function handleNext(){
      if(state.step === 0){
        var dojo = document.getElementById('dojo').value;
        if(!dojo){ showToast('Please pick your dojo first.'); return; }
        state.dojo = dojo;
      }
      if(state.step === 1){
        var name = document.getElementById('childName').value.trim();
        if(!name){ showToast('Add your child\'s first name.'); return; }
        state.childName = name;
      }
      if(state.step === 2){
        var gender = document.getElementById('gender').value;
        if(!gender){ showToast('Select a gender option.'); return; }
        state.gender = gender;
      }
      if(state.step === 3){
        var program = document.getElementById('program').value;
        if(!program){ showToast('Pick the program they attend.'); return; }
        state.program = program;
      }
      if(state.step === 4){
        if(!state.likes.length){
          showToast('Pick at least one thing you like.');
          return;
        }
      }
      // Step 5 (vibe) is always valid because a default is set.

      if(state.step === state.total - 2){
        // Moving into final step: generate caption + QR
        els.captionOutput.value = buildCaption();
        generateQR();
      }

      if(state.step < state.total - 1){
        setStep(state.step + 1);
      } else {
        // Finish: try copying caption as a nice UX touch
        if(els.captionOutput.value){
          els.captionOutput.select();
          try{
            document.execCommand('copy');
            showToast('Caption copied! Paste into your favorite app.');
          }catch(err){
            showToast('All set! Scroll up to copy your caption.');
          }
        }
      }
    }

    function handleBack(){
      if(state.step === 0) return;
      if(state.step === state.total - 1){
        // from final screen back to previous
        setStep(state.step - 1);
        return;
      }
      setStep(state.step - 1);
    }

    function init(){
      ensureLikesChips();
      ensureVibeButtons();
      setStep(0);

      els.next.addEventListener('click', handleNext);
      els.back.addEventListener('click', handleBack);
      els.copyCaption.addEventListener('click', function(){
        if(!els.captionOutput.value) return;
        els.captionOutput.select();
        try{
          document.execCommand('copy');
          showToast('Caption copied to clipboard');
        }catch(err){
          showToast('Press and hold to copy your caption.');
        }
      });
      els.regenCaption.addEventListener('click', function(){
        els.captionOutput.value = buildCaption();
        showToast('New version generated');
      });
      els.downloadQR.addEventListener('click', handleDownloadQR);

      // Minimal sanity checks (non-breaking)
      console.assert(typeof buildCaption === 'function', 'buildCaption should be defined');
      console.assert(Object.keys(vibes).length >= 3, 'Expected multiple vibe presets');
    }

    if(document.readyState === 'loading'){
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }

  })();
  </script>
</body>
</html>
